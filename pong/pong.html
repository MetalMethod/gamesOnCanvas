<!DOCTYPE html>
<html lang="en">
<head>
	<meta content="text/html;charset=utf-8" http-equiv="Content-Type">
	<meta content="utf-8" http-equiv="encoding">
</head>

<body>
    <canvas id="gameCanvas" width="800" height="600"></canvas>

    <script>
        let canvas, canvasContext;

        let ballSize = 10;
        let ballX = 75;
        let ballSpeedX = 5;
        let ballY = 75;
        let ballSpeedY = 5;

        const PADDLE_WIDTH = 10;
        const PADDLE_HEIGHT = 100;
        const PADDLE_DIST_FROM_EDGE = 60;
        const PADDLE_REFLECTION_FIX = 0.35;

        let paddleOneX = PADDLE_WIDTH * 2;
        let paddleOneY = 300;

		let paddleTwoX = 800 - PADDLE_WIDTH *2 ;
        let paddleTwoY = 300;

        function updateMousePos(evt){
            let rect = canvas.getBoundingClientRect();
            let root = document.documentElement;

            // let mouseX = evt.clientX - rect.left - root.scrollLeft;
            let mouseY = evt.clientY - rect.top - root.scrollTop;

            paddleOneY = mouseY - PADDLE_HEIGHT/2;
        }

        window.onload = function() {
            canvas = document.getElementById('gameCanvas');
            canvasContext = canvas.getContext('2d');

            let framesPerSecond = 30;
            setInterval(updateAll, 1000/framesPerSecond);

            canvas.addEventListener('mousemove', updateMousePos);
        }

        function updateAll(){
            moveAll();
            drawAll();
        }

        function ballReset(){
            ballX = canvas.width/2;
            ballY = canvas.height/2
            ballSpeedX *= -1;
        }

        function moveAll(){
            ballX += ballSpeedX;
            ballY += ballSpeedY;

            detectBallOnWalls();

            let paddleTopEdgeY = canvas.height - PADDLE_DIST_FROM_EDGE;
            let paddleBottomEdgeY = paddleTopEdgeY + PADDLE_HEIGHT;

            let paddleLeftEdgeX = paddleOneX;
            let paddleRightEdgeX = paddleLeftEdgeX + PADDLE_WIDTH;

            collisionDetetBallOnPaddle(paddleTopEdgeY, paddleBottomEdgeY, paddleLeftEdgeX, paddleRightEdgeX);

            blockPaddlesOutsideCanvas();
        }

        function drawAll(){
            colorRect(0,0, canvas.width, canvas.height, 'black');
            colorCircle(ballX,ballY, ballSize, 'white');

            colorRect(paddleOneX, paddleOneY, PADDLE_WIDTH ,PADDLE_HEIGHT, 'white');
			colorRect(paddleTwoX, 0 + PADDLE_DIST_FROM_EDGE, PADDLE_WIDTH ,PADDLE_HEIGHT, 'white');
        }

        function colorRect(topLeftX,topleftY, boxWidth,boxHeight, fillColor){
            canvasContext.fillStyle = fillColor;
            canvasContext.fillRect(topLeftX,topleftY, boxWidth,boxHeight);
        }

        function colorCircle(centerX,centerY, radius, fillColor){
            canvasContext.fillStyle =  fillColor;
            canvasContext.beginPath();
            canvasContext.arc(centerX, centerY, radius , 0, Math.PI*2, true);
            canvasContext.fill();
        }

        function collisionDetetBallOnPaddle(paddleTopEdgeY, paddleBottomEdgeY, paddleLeftEdgeX, paddleRightEdgeX){
            if( ballY > paddleTopEdgeY &&
                ballY < paddleBottomEdgeY &&
                ballX > paddleLeftEdgeX &&
                ballX < paddleRightEdgeX
                ){
                    ballSpeedY *= -1;

                    let centerOfpaddleOneX = paddleOneX + PADDLE_WIDTH/2;
                    let ballDistFromPaddleCenterX = ballX - centerOfpaddleOneX;
                    ballSpeedX = ballDistFromPaddleCenterX * PADDLE_REFLECTION_FIX;
                }
        }

        function detectBallOnWalls(){
            if(ballX < 0){ // left
                ballReset();
            }
            if(ballX > canvas.width){ // right
                ballReset();
            }
            if(ballY < ballSize){ // top
                ballSpeedY *= -1;
            }
            if(ballY > canvas.height - ballSize * 2){ // bottom
                ballSpeedY *= -1;
            }
        }

        // blocks both paddles if they go outside canvas
        function blockPaddlesOutsideCanvas(){
            // top
            if( paddleOneY < PADDLE_HEIGHT / 2){
                paddleOneY = PADDLE_HEIGHT / 2
            }
            // bottom
            if( paddleOneY > canvas.height - PADDLE_HEIGHT/ 2){
                paddleOneY = canvas.height - PADDLE_HEIGHT/ 2
            }
            // top
            if( paddleTwoY < PADDLE_HEIGHT / 2){
                paddleTwoY = PADDLE_HEIGHT / 2
            }
            // bottom
            if( paddleTwoY > canvas.height - PADDLE_HEIGHT/ 2){
                paddleTwoY = canvas.height - PADDLE_HEIGHT/ 2
            }
        }

    </script>
</body>
</html>